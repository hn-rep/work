ステップ1：名前解決（DNS）を確認
ゲスト内で以下を実行：

ping 8.8.8.8

? 通れば：

→ インターネットには出られるけど DNS 解決ができてない
? 通らなければ：

→ NAT で外に出るパケットが通っていない（次のステップへ）
? DNSが原因の場合の対策

/etc/resolv.conf を開いて、中身が例えばこれになっているか確認：

nameserver 8.8.8.8

なっていなければ、以下で一時的に設定：

echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

その後再度：

sudo apt update

?? ステップ2：NATが機能しているか確認（ルーティング）

ホストがゲストのパケットを外部に流すためには、IP転送（IP forwarding） が有効である必要があります。
ホスト側で確認：

cat /proc/sys/net/ipv4/ip_forward

結果が 1 でなければ：

sudo sysctl -w net.ipv4.ip_forward=1

または永続化するには /etc/sysctl.conf に：

net.ipv4.ip_forward=1

?? ステップ3：iptables/NAT設定（libvirtが通常やるけど確認）

通常は libvirt がこれを自動で設定していますが、もし壊れていたら以下のように NAT 設定を確認できます：

sudo iptables -t nat -L -n -v

MASQUERADE ルールが virbr0 に対して設定されているかを確認します。

例：

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  --  192.168.122.0/24     !192.168.122.0/24

もしなければ、以下のように手動で追加もできます：

sudo iptables -t nat -A POSTROUTING -s 192.168.122.0/24 ! -d 192.168.122.0/24 -j MASQUERADE

? おすすめの確認手順まとめ

    ping 8.8.8.8 → 通る？

    /etc/resolv.conf → DNS は正しい？

    ホストで ip_forward = 1？

    ホストで iptables -t nat → MASQUERADE ある？
